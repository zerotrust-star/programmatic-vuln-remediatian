# Run PowerShell as Administrator

# Enable SMBv1 - CIFS File Sharing Support
Write-Output "Enabling SMBv1 Protocol..."
Enable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol -NoRestart

# Check if the SMBv1 Client registry key exists and enable it
$smbClientPath = "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters"
$smbClientDriverPath = "HKLM:\SYSTEM\CurrentControlSet\Services\mrxsmb10"
Write-Output "Enabling SMBv1 Client..."
if (Test-Path $smbClientPath) {
    Set-ItemProperty -Path $smbClientPath -Name "AllowInsecureGuestAuth" -Value 1
}
if (Test-Path $smbClientDriverPath) {
    Set-ItemProperty -Path $smbClientDriverPath -Name "Start" -Value 2
} else {
    Write-Output "SMBv1 Client driver registry path does not exist. It may not be necessary or supported on this system."
}

# Enable the SMBv1 Server
$smbServerPath = "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters"
Write-Output "Enabling SMBv1 Server..."
if (Test-Path $smbServerPath) {
    Set-ItemProperty -Path $smbServerPath -Name "SMB1" -Value 1
} else {
    Write-Output "SMBv1 Server registry path does not exist. Check if SMBv1 is supported on this system."
}

Write-Output "Process completed. Please review the output for any potential issues."
